
	Red Rescue Team Item Set Editor
		made by Cipnit and Nahnegnal



ONLY WORKS ON THE US/AUS VERSION OF RED RESCUE TEAM
Remember to edit a copy of your ROM - always keep a backup

ALSO NOTE: THE FILE DEFAULT_ITEMSET_LIST.txt IS REQUIRED FOR THE PROGRAM TO RUN, AND SHOULD NOT BE EDITED. DO NOT REMOVE THE BLANK NEWLINE AT ITS END, OR ADD NEWLINES.
OFFSETS.txt should also be unedited, unless you want to change the program to work with an EU or JP version. Note that the file must end with a newline, no more or less than one.

TO EASILY OPEN A COMMAND WINDOW: In the window of the directory RRT_itemsetter.exe is in, hold shift, and press the right mouse button on an empty space. In the context menu, you should see the option "Open command window here". This allows you to open a command window without having to find it in your start menu and using CD to navigate to the directory.


Item sets are the pools RRT draws from when it needs to spawn items in a dungeon. This tool can be used to extract an item set's binary data from the ROM and convert it into an editable plain text list, and convert a plain text list into binary data before putting it into the ROM.
This tool also helps you find the IDs of item sets that the floors of dungeons use, but doesn't change them for you - instructions on how to change them yourself are at the end of this file.

To create an item set, copy DefaultItemSetList.txt (or use this tool to extract a list from the ROM), fill in the numbers with your percentages of item categories and items, then run RRT_itemsetter.exe with the appropriate commands to convert the list into item set data. 
-DO NOT add or remove text in the file. Certain words (the "Nothing" item and items ending in "Orb") are crucial to the program's operation.
-Make sure each line's number is five digits long with a period after the third digit (so 20% should be written as 020.00)
-The total percentages of categories MUST equal 100%, and the total percentages of items within categories MUST ALSO equal 100%.
-Note that each nonzero chance in the item list will add 2 bytes to the size of item set data, and empty space between two nonzero lines will add 2 bytes. 

For example, if Rocks is 050.00, Hold Items is 050.00, Geo Pebble is 100.00, and Mobile Scarf (which is right beside Geo Pebble) is 100.00, then the item list data translated to english will be "Skip to Rocks, set to 50%, skip to Hold Items, set to 50%, skip to Geo Pebble, set to 100%, set next item to 100%" - 14 bytes long.

Note that this program WILL NOT check if item percentages overlap to different categories. For example, if you do the following, leaving everything else blank:
040.00 Hold Items
020.00 TMs
040.00 Orbs
040.00 Detect Band	hold items
040.00 Alert Specs
020.00 Hyper Beam	TMs	<INCORRECT: detect + alert + hyper adds up to 100, hold items overlap with TMs
100.00 Light Screen
050.00 Stayaway Orb	orbs
050.00 Pounce Orb		<but items add up to 3 groups of 100% and there are 3 categories, so no error is detected
The program will create the item set without any error message, but RRT may bug up when the item set is used in the game. What will likely happen is the chances of items appearing will be extremely skewed, but there's no way to know if the game will be completely stable.



COMMAND LINE OPTIONS: After typing RRT_itemsetter.exe in the command window, add commands separated with a space before pressing enter. 

"romname.gba"
	getdungeonsets 00
	extract 00
	insert "itemsetlist.txt" 00
rawdata
	create "itemsetlist.txt"
	extract "extract.bin"


For example, valid commands look like this: 
RRT_itemsetter.exe "Pokemon Mystery Dungeon Red Rescue Team.gba" getdungeonsets 3
RRT_itemsetter.exe rawdata create "my item list.txt"




 rom "romname.gba"			Extract from or insert to a ROM - "romname.gba" should be replaced with your ROM's name. Must be followed by extract, getdungeonsets, or insert.

  getdungeonsets 00			Gives you the item sets each floor of a dungeon is using - replace 00 with the dungeon's ID (number MUST be in hexadecimal, 0x prefix is not required). Note that the item set kecleon shops use is 1, the item set for monster houses is 2, and the item set for items hidden in walls is 3, in all dungeons other than late postgame dungeons. Read below on how to get a dungeon's ID and how you can manually change which item set a floor uses.

  extract 00				Extracts an item set from the ROM and converts it to a plain text file called "output.txt" - replace 00 with its ID (must be hexadecimal without 0x). IF ITEMS IN A CATEGORY DO NOT ADD UP TO 100% OR IF YOU FIND NEGATIVE NUMBERS IN THE LIST, PLEASE TELL ME WHICH SET YOU FOUND THE BUG IN. I assumed that, other than TMs and Orbs, all the items are grouped based on their category - if a non-100% item set or negative item chance is found, that means there's more categories which are mixed, and I'll have to fix the code to accomidate it.

  insert "itemsetlist.txt" 00		Converts the item list in "itemsetlist.txt" to item set data and replaces a specified item set in the ROM with it. Change 00 to the ID of the item set to replace (must be hexadecimal without 0x). The program will give you an error if the item set data is too long.

 rawdata create "itemsetlist.txt"	Converts the item list in "itemsetlist.txt" to item set data and puts it in a new binary file called "output.bin". Use if you want to create item set data without a size restriction. To put it in the ROM, you'll need to put it in empty space, then repoint the pointer of the item set you want to replace.

 rawdata extract "extract.bin"		Converts the item set binary data titled "extract.bin", which was created with the rawdata insert command, back into a plain text file, called "output.txt". 


TO FIND A DUNGEON'S ID: Get an emulator with a RAM viewing feature (such as no$gba's debugger, VBA, or VBA-M, though VBA-M's memory viewer is buggy). Open your RRT ROM with this emulator: enter a dungeon, wait for the floor to generate, then go to 02004138 in the memory viewer (this address only works in a US/Australian ROM). This byte (two hexadecimal digits, 00-FF) is the dungeon's ID.

TO EDIT A FLOOR'S ITEM SETS: First, use the command getdungeonsets to get the offset to dungeon floor data. Each dungeon floor entry is 16 (0x10) bytes long, and the first entry is always blank (filled with zeroes): to get a floor data entry's address, convert the floor number to hexadecimal, multiply it by 0x10, and add it to the dungeon floor data offset. A floor data entry's address +6 is the item set it's using, +8 is the item set kecleon shops on that floor use, +0xA is the item set for monster houses on that floor, and +0xC is the item set for items living in the floor's walls. 
